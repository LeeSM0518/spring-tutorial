# 도메인 분석 설계

## 목차

* 요구사항 분석
* 도메인 모델과 테이블 설계
* 엔티티 클래스 개발
* 엔티티 설계시 주의점

<br>

## 요구사항 분석

### 기능 목록

* 회원 기능
  * 회원 등록
  * 회원 조회
* 상품 기능
  * 상품 등록
  * 상품 수정
  * 상품 조회
* 주문 기능
  * 상품 주문
  * 주문 내역 조회
  * 주문 취소
* 기타 요구사항
  * 상품은 제고 관리가 필요하다.
  * 상품의 종류는 도서, 응반, 영화가 있다.
  * 상품을 카테고리로 구분할 수 있다.

<br>

## 도메인 모델과 테이블 설계

![image](https://user-images.githubusercontent.com/43431081/89701405-a9b58980-d971-11ea-9a04-29928a725756.png)

<br>

### 회원 엔티티 분석

![image](https://user-images.githubusercontent.com/43431081/89701512-9c4ccf00-d972-11ea-92e6-320f671e2de6.png)

<br>

## 회원 테이블 분석

![image](https://user-images.githubusercontent.com/43431081/89701570-285ef680-d973-11ea-81a4-dc391cf2ca3e.png)

<br>

### 연관관계 매핑 분석

* **회원과 주문**
  * 양방향 연관 관계이면서 일대다 관계이다.
  * 연관관계의 주인을 정해야 하는데 외래 키가 있는 주문을 연관관계의 주인으로 정하는 것이 좋다.
  * 그러므로 `Order.member` 를 `ORDERS.MEMBER_ID` 외래 키와 매핑한다.
  * 주인 쪽에서 변경이 가능하고, 거울은 조회만 가능하다.
* **주문과 주문상품**
  * 다대일 양방향 관계이다.
  * 주문상품이 연관관계의 주인이다.
  * 그러므로 `OrderItem.order` 를 `ORDER_ITEM.ORDER_ID` 외래 키와 매핑한다.
* **주문상품과 상품**
  * 다대일 단방향 관계이다. (화살표가 단방향 관계를 의미한다)
  * `OrderItem.item` 을 `ORDER_ITEM.ITEM_ID` 외래 키와 매핑한다.
* **주문과 배송**
  * 일대일 양방향 관계다.
  * `Order.delivery` 를 `ORDERS.DELIVERY_ID` 외래 키와 매핑한다.
* **카테고리와 상품**
  * 다대다 관계
  * `@ManyToMany` 사용 (실무에서는 사용하지 말자.)

<br>

연관관계의 주인은 단순히 외래 키를 누가 관리하냐의 문제이지 비즈니스상 우위에 있다고 주인으로 정하면 안된다.

즉, **외래 키가 있는 곳을 연관관계의 주인으로 정해라.**